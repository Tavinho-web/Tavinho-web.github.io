<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Para ti ‚ú®</title>
  <style>
  :root{
    --bg1:#0b0b14;
    --bg2:#0a1b2d;
    --card: rgba(255,255,255,.06);
    --card2: rgba(255,255,255,.10);
    --text:#f4f4ff;
    --muted:rgba(255,255,255,.72);
    --ring: rgba(255,255,255,.22);

    /* acentos */
    --a1:#ff4fd8;
    --a2:#7c5cff;
    --a3:#22d3ee;
    --a4:#34d399;
    --a5:#fbbf24;
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(900px 600px at 15% 10%, rgba(255,79,216,.22), transparent 55%),
      radial-gradient(850px 520px at 95% 5%, rgba(124,92,255,.22), transparent 55%),
      radial-gradient(900px 520px at 70% 95%, rgba(34,211,238,.18), transparent 55%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    min-height:100vh;
  }

  /* burbujitas decorativas */
  body::before, body::after{
    content:"";
    position:fixed;
    inset:auto;
    width:360px; height:360px;
    filter: blur(45px);
    opacity:.35;
    pointer-events:none;
    border-radius:999px;
    z-index:-1;
  }
  body::before{
    left:-120px; top:140px;
    background: radial-gradient(circle at 30% 30%, var(--a4), transparent 60%),
                radial-gradient(circle at 70% 70%, var(--a1), transparent 60%);
  }
  body::after{
    right:-140px; bottom:120px;
    background: radial-gradient(circle at 30% 30%, var(--a2), transparent 60%),
                radial-gradient(circle at 70% 70%, var(--a5), transparent 60%);
  }

  .wrap{ max-width: 980px; margin: 0 auto; padding: 28px 18px 60px; }

  header{
    display:flex; align-items:flex-end; justify-content:space-between; gap:16px;
    margin-bottom:18px;
    padding:16px 16px;
    border-radius:18px;
    background: linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.10);
    backdrop-filter: blur(10px);
  }

  h1{
    font-size: 22px;
    margin:0;
    letter-spacing:.2px;
    background: linear-gradient(90deg, var(--text), rgba(255,255,255,.75));
    -webkit-background-clip:text;
    background-clip:text;
    color:transparent;
  }
  .sub{ margin:6px 0 0; color:var(--muted); font-size: 14px; }

  .grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 12px;
  }
  @media (max-width: 720px){
    .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }

  .tile{
    border-radius: 16px;
    overflow:hidden;
    cursor:pointer;
    position:relative;
    outline: none;
    aspect-ratio: 1 / 1;
    padding:0;

    background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.12);
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
    transform: translateY(0);
    transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  }
  .tile::before{
    content:"";
    position:absolute; inset:-2px;
    background: linear-gradient(135deg, rgba(255,79,216,.35), rgba(34,211,238,.22), rgba(124,92,255,.30));
    opacity:0;
    transition: opacity .18s ease;
    z-index:0;
    filter: blur(10px);
  }
  .tile:hover{
    transform: translateY(-4px);
    box-shadow: 0 18px 50px rgba(0,0,0,.35);
    border-color: rgba(255,255,255,.20);
  }
  .tile:hover::before{ opacity:1; }

  .tile img{
    position:relative; z-index:1;
    width:100%; height:100%;
    object-fit: cover;
    display:block;
    transform: scale(1.02);
    transition: transform .2s ease, filter .2s ease;
    filter: saturate(1.08) contrast(1.05) brightness(1.02);
  }
  .tile:hover img{ transform: scale(1.06); }

  .tile:focus-visible{ box-shadow: 0 0 0 3px var(--ring), 0 18px 50px rgba(0,0,0,.35); }

  .badge{
    position:absolute; left:10px; bottom:10px;
    font-size:12px; font-weight:700;
    color: rgba(255,255,255,.92);
    background: linear-gradient(135deg, rgba(255,79,216,.95), rgba(34,211,238,.95));
    border:1px solid rgba(255,255,255,.20);
    padding:7px 10px; border-radius: 999px;
    z-index:2;
    box-shadow: 0 10px 20px rgba(0,0,0,.25);
    text-shadow: 0 6px 18px rgba(0,0,0,.35);
  }

  footer{
    margin-top: 18px;
    color: rgba(255,255,255,.60);
    font-size: 12px;
    padding:10px 2px;
  }

  /* Modal */
  .modal[hidden]{ display:none; }
  .modal{
    position:fixed; inset:0;
    background: rgba(0,0,0,.70);
    display:flex; align-items:center; justify-content:center;
    padding: 18px;
    z-index: 50;
  }
  .panel{
    width:min(920px, 100%);
    border-radius: 18px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,.14);
    background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
    backdrop-filter: blur(12px);
    box-shadow: 0 20px 60px rgba(0,0,0,.55);
  }
  .panelTop{
    display:flex; justify-content:space-between; align-items:center;
    padding: 12px 14px;
    border-bottom:1px solid rgba(255,255,255,.10);
  }
  .panelTop .hint{ color:rgba(255,255,255,.72); font-size: 12px; }
  .close{
    border:none; background: rgba(255,255,255,.08); color: var(--text);
    font-size: 18px; cursor:pointer;
    padding: 8px 10px; border-radius: 12px;
    transition: transform .15s ease, background .15s ease;
  }
  .close:hover{ background: rgba(255,255,255,.14); transform: scale(1.03); }

  .panelBody{
    display:grid;
    grid-template-columns: 1.2fr .8fr;
  }
  @media (max-width: 820px){
    .panelBody{ grid-template-columns: 1fr; }
  }
  .big{
    background: rgba(0,0,0,.25);
    display:flex; align-items:center; justify-content:center;
    padding: 10px;
  }
  .big img{
    width:100%; height:100%;
    max-height: 72vh;
    object-fit: contain;
    border-radius: 12px;
    background: rgba(0,0,0,.20);
  }
  .caption{
    padding: 16px 16px 18px;
    display:flex; flex-direction:column; gap:10px;
  }
  .caption h2{
    margin:0;
    font-size: 16px;
    letter-spacing:.2px;
    background: linear-gradient(90deg, rgba(255,255,255,.95), rgba(255,255,255,.70));
    -webkit-background-clip:text;
    background-clip:text;
    color:transparent;
  }
  .caption p{
    margin:0;
    color: rgba(255,255,255,.82);
    line-height: 1.65;
    font-size: 14px;
    white-space: pre-wrap;
    text-wrap: pretty;
  }

  /* Mejor responsive del modal (especialmente en celular) */
  .modal{
    padding:
      calc(18px + env(safe-area-inset-top))
      calc(18px + env(safe-area-inset-right))
      calc(18px + env(safe-area-inset-bottom))
      calc(18px + env(safe-area-inset-left));
  }

  .panel{
    max-height: 92vh;           /* evita que el modal se "salga" de la pantalla */
    display: flex;
    flex-direction: column;
  }

  .panelBody{
    flex: 1;
    overflow: hidden;           /* el scroll lo maneja la caption */
  }

  .caption{
    overflow: auto;             /* permite leer textos largos en m√≥vil */
    -webkit-overflow-scrolling: touch;
  }

  /* En pantallas peque√±as: imagen m√°s baja + texto scrolleable */
  @media (max-width: 520px){
    .big img{
      max-height: 42vh;         /* antes 72vh */
    }
    .caption p{
      font-size: 13px;          /* un pel√≠n m√°s compacto en cel */
    }
  }

  /* Animaciones suaves */
  @keyframes popIn {
    from { transform: translateY(8px) scale(.98); opacity: 0; }
    to   { transform: translateY(0)   scale(1);   opacity: 1; }
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to   { opacity: 1; }
  }

  .modal{ animation: fadeIn .18s ease; }
  .panel{ animation: popIn .22s ease; }

  @media (prefers-reduced-motion: reduce){
    .modal, .panel, .tile{ animation:none !important; transition:none !important; }
  }

  /* Botones de navegaci√≥n */
  .navBtns{
    display:flex;
    gap:10px;
    align-items:center;
  }
  .navBtn{
    border:none;
    cursor:pointer;
    color: var(--text);
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.14);
    padding: 8px 10px;
    border-radius: 12px;
    transition: transform .15s ease, background .15s ease;
    font-size: 14px;
  }
  .navBtn:hover{ background: rgba(255,255,255,.16); transform: translateY(-1px); }
  .navBtn:active{ transform: translateY(0); }

  /* ===== Fondo en movimiento (suave) ===== */

  /* Mueve ligeramente los gradientes del fondo */
  body{
    background-size: 200% 200%, 200% 200%, 200% 200%, 100% 100%;
    animation: bgMove 18s ease-in-out infinite;
  }

  @keyframes bgMove{
    0%{
      background-position: 15% 10%, 95% 5%, 70% 95%, 0 0;
    }
    50%{
      background-position: 10% 18%, 88% 12%, 62% 88%, 0 0;
    }
    100%{
      background-position: 15% 10%, 95% 5%, 70% 95%, 0 0;
    }
  }

  /* Anima las "burbujas" que ya tienes */
  body::before{
    animation: blobA 14s ease-in-out infinite alternate;
    will-change: transform;
  }
  body::after{
    animation: blobB 17s ease-in-out infinite alternate;
    will-change: transform;
  }

  @keyframes blobA{
    0%   { transform: translate(0,0) scale(1); }
    50%  { transform: translate(40px,-30px) scale(1.06); }
    100% { transform: translate(-10px,10px) scale(1.02); }
  }
  @keyframes blobB{
    0%   { transform: translate(0,0) scale(1); }
    50%  { transform: translate(-35px,25px) scale(1.07); }
    100% { transform: translate(10px,-10px) scale(1.03); }
  }

  /* Respeta accesibilidad: si el usuario prefiere menos movimiento */
  @media (prefers-reduced-motion: reduce){
    body{ animation: none; }
    body::before, body::after{ animation: none; }
  }

  /* Canvas de fondo animado */
  #bgCanvas{
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: -2;          /* detr√°s de todo */
    pointer-events: none; /* no bloquea clicks */
    opacity: .9;
  }
  </style>
</head>
<body>
  <canvas id="bgCanvas" aria-hidden="true"></canvas>
  <div class="wrap">
    <header>
      <div>
        <h1>Un √°lbum para ti üíõ</h1>
        <p class="sub">12 recuerdos contigo. Toca una foto para leer lo que sent√≠ ese d√≠a.</p>
      </div>
      <div style="color:rgba(255,255,255,.55);font-size:12px;">‚Äî de m√≠ para ti</div>
    </header>

    <main class="grid" aria-label="√Ålbum de 12 fotos">
      <!-- Cambia las rutas img/01.jpg ... img/12.jpg por tus fotos -->
      <!-- Cambia data-title y data-text por tus frases -->
      <button class="tile" data-index="0" data-title="Nuestro inicio" data-text="Ese d√≠a te ped√≠ que fueras mi novia porque me di cuenta de algo sencillo pero enorme: contigo todo se siente en calma. No era solo emoci√≥n, era certeza. Certeza de que quer√≠a cuidarte, respetarte y construir algo bonito a tu lado. Desde ese momento supe que no quer√≠a estar solo en los d√≠as buenos, sino tambi√©n ser tu equipo en los d√≠as dif√≠ciles. Y si volviera a ese instante, te lo pedir√≠a otra vez‚Ä¶ sin pensarlo.">
        <img src="img/imagen1.jpg" alt="Foto 1" loading="lazy">
        <span class="badge">1</span>
      </button>
      <button class="tile" data-index="1" data-title="Tu sonrisa" data-text="Ese d√≠a te vi con esas flores y pens√©: qu√© lindo verte recibir detalles‚Ä¶ pero m√°s lindo es lo que t√∫ transmites. T√∫ haces que todo se vea m√°s vivo: tu energ√≠a, tu risa, tu forma de mirar. Tu sonrisa no es solo una sonrisa; es mi lugar seguro, mi buena noticia del d√≠a. Y si pudiera elegir un momento para repetir, ser√≠a cualquiera donde t√∫ est√©s as√≠ de feliz.">
        <img src="img/imagen2.jpg" alt="Foto 2" loading="lazy">
        <span class="badge">2</span>
      </button>
      <button class="tile" data-index="2" data-title="Una de las primeras citas" data-text="En esas primeras citas yo todav√≠a estaba descubri√©ndote‚Ä¶ pero mi coraz√≥n ya empezaba a reconocer algo: contigo me sent√≠a en casa. No porque todo fuera perfecto, sino porque todo se sent√≠a real. Tu presencia me daba calma, tu mirada me daba confianza, y tu forma de estar conmigo me hac√≠a pensar ‚Äòesto vale la pena‚Äô. Ah√≠ empez√≥ a nacer ese ‚Äònosotros‚Äô.">
        <img src="img/imagen3.jpg" alt="Foto 3" loading="lazy">
        <span class="badge">3</span>
      </button>
      <button class="tile" data-index="3" data-title="El primer 2pa2 con tus papas" data-text="La primera salida con tus pap√°s me dej√≥ un recuerdo muy bonito. Pens√© que me iba a sentir nervioso, pero termin√© sinti√©ndome en confianza y disfrutando el momento. Me gust√≥ estar ah√≠, conocerlos y sentir que pod√≠a ser yo. aunque hubo un momento inc√≥modo, lo que m√°s me qued√≥ fue esto: contigo todo se siente m√°s tranquilo, como si incluso lo raro pasara r√°pido porque estamos juntos en el mismo equipo.">
        <img src="img/imagen4.jpg" alt="Foto 4" loading="lazy">
        <span class="badge">4</span>
      </button>
      <button class="tile" data-index="4" data-title="La primera ida a sab" data-text="Mi primera vez en Sabanalarga fue contigo, y por eso fue especial. Fuimos a ver el desfile de Navidad y yo solo pensaba en lo bonito que es compartir contigo cosas nuevas. Y me qued√≥ claro algo: contigo cualquier lugar se siente como plan perfecto.">
        <img src="img/imagen5.jpg" alt="Foto 5" loading="lazy">
        <span class="badge">5</span>
      </button>
      <button class="tile" data-index="5" data-title="Tu grado" data-text="El d√≠a de tu grado fue precioso. Verte cumplir esa meta me hizo sentir demasiado orgullo. Te di flores porque quer√≠a que sintieras lo mucho que te admiro y lo feliz que me hace verte crecer. Ese recuerdo me queda como uno de los m√°s bonitos contigo.">
        <img src="img/imagen6.jpg" alt="Foto 6" loading="lazy">
        <span class="badge">6</span>
      </button>
      <button class="tile" data-index="6" data-title="Primera salida con Mari" data-text="Nuestra primera salida con Mari fue demasiado linda. Fue la primera vez que nos dieron esa confianza y me hizo sentir muy bien. Mari se divirti√≥ un mont√≥n jugando, y yo me qued√© con ese recuerdo: nosotros cuid√°ndola, ri√©ndonos, y creando momentos bonitos en familia.">
        <img src="img/imagen7.jpg" alt="Foto 7" loading="lazy">
        <span class="badge">7</span>
      </button>
      <button class="tile" data-index="7" data-title="La primera ida al gym" data-text="Una de nuestras primeras idas al gym, cuando yo todav√≠a estaba flaco y apenas nos est√°bamos conociendo mejor. Me encanta porque me recuerda lo simple: compartir tiempo contigo, re√≠rnos y ir creando esa confianza que ahora se siente tan natural.">
        <img src="img/imagen8.jpg" alt="Foto 8" loading="lazy">
        <span class="badge">8</span>
      </button>
      <button class="tile" data-index="8" data-title="Primer cumplea√±os" data-text="Este fue tu primer cumplea√±os estando juntos, y yo estaba feliz. Fue la primera vez que te di rosas reales y ver tu cara vali√≥ todo. En Sabanalarga comimos con casi toda tu familia y me sent√≠ en confianza. Y ese d√≠a tambi√©n fue la primera vez que me qued√© a dormir donde tu t√≠o Bon‚Ä¶ un recuerdo que guardo con mucho cari√±o.">
        <img src="img/imagen9.jpg" alt="Foto 9" loading="lazy">
        <span class="badge">9</span>
      </button>
      <button class="tile" data-index="9" data-title="Tus primitos" data-text="Despu√©s de la comida de tu cumplea√±os estuvimos con tus primitos y fue demasiado ch√©vere. Me cayeron bien y sent√≠ que yo tambi√©n les ca√≠ bien. Aunque al principio Jes√∫s no me quer√≠a mucho, despu√©s todo fluy√≥, y Jos√© desde el comienzo siempre me habl√≥.">
        <img src="img/imagen10.jpg" alt="Foto 10" loading="lazy">
        <span class="badge">10</span>
      </button>
      <button class="tile" data-index="10" data-title="Primera vez viendo al Junior campeon" data-text="Nuestra primera final viendo al Junior juntos‚Ä¶ y qu√© final: ganamos de sobra y lleg√≥ la 11¬™ estrella. Ese d√≠a ganamos los tres: t√∫ tus hamburguesas, yo tu compa√±√≠a, y Junior el campeonato. Plan redondo. Pero lo que m√°s me gust√≥ fue vivirlo contigo: re√≠rnos, comer, abrazarnos y quedarnos con esa energ√≠a de ‚Äúqu√© bonito compartir esto‚Äù. Junior gan√≥‚Ä¶ pero yo tambi√©n, porque estaba contigo.">
        <img src="img/imagen11.jpg" alt="Foto 11" loading="lazy">
        <span class="badge">11</span>
      </button>
      <button class="tile" data-index="11" data-title="Primera navidad juntos" data-text="Nuestra primera Navidad juntos fue muy especial, aunque en las fechas exactas con la familia no pudimos estar pegados todo el tiempo. Pero lo bonito es que los d√≠as antes y despu√©s s√≠ tuvimos much√≠simo tiempo juntos en Sabanalarga, y eso nos uni√≥ m√°s: a nosotros y tambi√©n a tu familia conmigo. Nos dimos regalos, nos compramos esas pijamas de Snoopy y nos re√≠mos como ni√±os. Diciembre fue incre√≠ble para los dos, de esos meses que uno guarda en el coraz√≥n porque se siente hogar.">
        <img src="img/imagen12.jpg" alt="Foto 12" loading="lazy">
        <span class="badge">12</span>
      </button>
    </main>

    <footer>Tip: en el modal puedes cerrar con <b>Esc</b> o tocando afuera.</footer>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" hidden>
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <div class="panelTop">
        <div class="hint">Toca afuera o presiona Esc para cerrar</div>
        <div class="navBtns">
          <button class="navBtn" id="prevBtn" aria-label="Anterior">‚Üê</button>
          <button class="navBtn" id="nextBtn" aria-label="Siguiente">‚Üí</button>
          <button class="close" id="closeBtn" aria-label="Cerrar">‚úï</button>
        </div>
      </div>
      <div class="panelBody">
        <div class="big">
          <img id="mImg" src="" alt="Foto ampliada">
        </div>
        <div class="caption">
          <h2 id="mTitle"></h2>
          <p id="mText"></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const tiles = Array.from(document.querySelectorAll(".tile"));
    const modal = document.getElementById("modal");
    const closeBtn = document.getElementById("closeBtn");
    const mImg = document.getElementById("mImg");
    const mTitle = document.getElementById("mTitle");
    const mText = document.getElementById("mText");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    let lastFocused = null;
    let currentIndex = 0;

    function renderFromTile(tile){
      const img = tile.querySelector("img");
      mImg.src = img.src;
      mImg.alt = img.alt;
      mTitle.textContent = tile.dataset.title || "Recuerdo";
      mText.textContent = tile.dataset.text || "";
    }

    function openModal(tile){
      lastFocused = document.activeElement;
      currentIndex = Number(tile.dataset.index || 0);
      renderFromTile(tile);
      modal.hidden = false;

      // mover foco al bot√≥n cerrar (accesibilidad)
      closeBtn.focus();
      document.body.style.overflow = "hidden";
    }

    function closeModal(){
      modal.hidden = true;
      document.body.style.overflow = "";
      if (lastFocused) lastFocused.focus();
    }

    tiles.forEach(tile => {
      tile.addEventListener("click", () => openModal(tile));
    });

    closeBtn.addEventListener("click", closeModal);

    // Cerrar tocando el fondo
    modal.addEventListener("click", (e) => {
      if (e.target === modal) closeModal();
    });

    function go(delta){
      currentIndex = (currentIndex + delta + tiles.length) % tiles.length;
      renderFromTile(tiles[currentIndex]);
    }

    prevBtn.addEventListener("click", () => go(-1));
    nextBtn.addEventListener("click", () => go(1));

    // Cerrar con Escape, navegar con flechas
    document.addEventListener("keydown", (e) => {
      if (modal.hidden) return;
      if (e.key === "Escape") closeModal();
      if (e.key === "ArrowLeft") go(-1);
      if (e.key === "ArrowRight") go(1);
    });
  </script>

  <script>
    // ===== Fondo animado con part√≠culas (corazoncitos + puntitos) =====
    (function(){
      const reduceMotion = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduceMotion) return;

      const canvas = document.getElementById('bgCanvas');
      const ctx = canvas.getContext('2d', { alpha: true });

      const rootStyles = getComputedStyle(document.documentElement);
      const palette = ['--a1','--a2','--a3','--a4','--a5'].map(v => rootStyles.getPropertyValue(v).trim());

      function hexToRgb(hex){
        const h = hex.replace('#','').trim();
        const full = h.length === 3 ? h.split('').map(c=>c+c).join('') : h;
        const n = parseInt(full, 16);
        return { r:(n>>16)&255, g:(n>>8)&255, b:n&255 };
      }
      function rgbaFromHex(hex, a){
        const {r,g,b} = hexToRgb(hex || '#ffffff');
        return `rgba(${r},${g},${b},${a})`;
      }

      function resize(){
        const dpr = Math.min(window.devicePixelRatio || 1, 2);
        canvas.width = Math.floor(window.innerWidth * dpr);
        canvas.height = Math.floor(window.innerHeight * dpr);
        canvas.style.width = window.innerWidth + 'px';
        canvas.style.height = window.innerHeight + 'px';
        ctx.setTransform(dpr,0,0,dpr,0,0);
      }
      window.addEventListener('resize', resize);
      resize();

      const isMobile = window.matchMedia && window.matchMedia('(max-width: 520px)').matches;
      const COUNT = isMobile ? 50 : 80;

      const particles = [];
      function rand(min,max){ return Math.random()*(max-min)+min; }

      function drawHeart(x,y,size,rot,color){
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate(rot);
        ctx.scale(size, size);

        ctx.beginPath();
        // coraz√≥n simple (path)
        ctx.moveTo(0, 0.35);
        ctx.bezierCurveTo(-0.5, -0.05, -0.55, -0.6, 0, -0.35);
        ctx.bezierCurveTo(0.55, -0.6, 0.5, -0.05, 0, 0.35);
        ctx.closePath();

        ctx.fillStyle = color;
        ctx.shadowColor = color;
        ctx.shadowBlur = 18;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;
        ctx.fill();

        ctx.restore();
      }

      function spawn(){
        const colorHex = palette[Math.floor(Math.random()*palette.length)] || '#ffffff';
        const type = Math.random() < 0.85 ? 'heart' : 'dot';
        const size = type === 'heart' ? rand(14, 26) : rand(2, 4);
        const p = {
          x: rand(0, window.innerWidth),
          y: rand(0, window.innerHeight),
          vx: rand(-0.15, 0.15),
          vy: rand(-0.35, -0.12),
          size,
          rot: rand(0, Math.PI*2),
          spin: rand(-0.01, 0.01),
          alpha: rand(0.50, 0.90),
          colorHex,
          type
        };
        particles.push(p);
      }

      for(let i=0;i<COUNT;i++) spawn();

      let lastT = performance.now();

      function step(t){
        const dt = Math.min((t - lastT) / 16.67, 2);
        lastT = t;

        ctx.clearRect(0,0,window.innerWidth, window.innerHeight);

        // mejor visibilidad
        ctx.globalCompositeOperation = 'source-over';

        for (const p of particles){
          p.x += p.vx * dt * 10;
          p.y += p.vy * dt * 10;
          p.rot += p.spin * dt * 10;

          // respawn si se va por arriba o lados
          if (p.y < -40) { p.y = window.innerHeight + 40; p.x = rand(0, window.innerWidth); }
          if (p.x < -40) p.x = window.innerWidth + 40;
          if (p.x > window.innerWidth + 40) p.x = -40;

          const col = rgbaFromHex(p.colorHex, p.alpha);

          if (p.type === 'dot'){
            ctx.beginPath();
            ctx.fillStyle = col;
            ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);
            ctx.fill();
          }else{
            drawHeart(p.x, p.y, p.size/18, p.rot, col);
          }
        }

        ctx.globalCompositeOperation = 'source-over';
        requestAnimationFrame(step);
      }

      // pausa si la pesta√±a no est√° visible
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) lastT = performance.now();
      });

      requestAnimationFrame(step);
    })();
  </script>
</html>

